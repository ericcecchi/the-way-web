// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r,i,s,o,u,a;r=function(){var e;console.log("Getting language.");e=o("lang");return e?e:"en"};u=function(n){console.log("Setting language.");t("lang");$("#pdf-download").attr("href","/theway/content/"+n+"/The-Way-"+n+".pdf");$("#current-language").html($('a[data-language="'+n+'"]').text()+'<b class="caret"></b>');return e("lang",n,9001)};i=function(){var e;console.log("Getting section.");e=o("section");return e?e:$("#section-tabs a").first().attr("data-section")};a=function(n){console.log("Setting section.");t("section");return e("section",n,9001)};n=function(){var e,t,n;console.log("Getting content.");e=r();t=i();t&&(n=/^[0-9]+/.exec(t));return $("#content").fadeOut(200,function(){$("#spinner").spin({lines:9,length:2,width:10,radius:20});return $.ajax({url:"json.php?lang="+e+"&section="+t,dataType:"json"}).done(function(e){var t,r;if(e){r=e.content.replace(/\<![ \r\n\t]*(--([^\-]|[\r\n]|-[^\-])*--[ \r\n\t]*)\>/,"");t='<div class="tab-pane" id="section-'+n+'">'+r+"</div>";$("#content").html(t);$(".tab-pane h2").first().toggleClass("first-question");$("h2").nextUntil("h2").toggleClass("hide");$("h2").click(function(){$(this).nextUntil("h2").slideToggle(250);return $(this).toggleClass("open")});$('#section-tabs a[href="#section-'+n+'"]').tab("show");$("#spinner").spin(!1);return $("#content").fadeIn(200)}})})};s=function(){var e;console.log("Getting sections.");e=r();u(e);$("#content").fadeOut(200);return $("#sidebar").fadeOut(200,function(){return $.ajax({url:"json.php?lang="+e,dataType:"json"}).done(function(e){var t;$("#content").html(e);if(e){t='<li class="nav-header">Sections</li>';$.each(e.items,function(e,n){var r;r=/^[0-9]+/.exec(n.meta.slug);return t+='<li><a href="#section-'+r+'" data-section="'+n.meta.slug+'">'+/[^0-9-].*/.exec(n.meta.slug)[0].replace(/-/g," ")+"</a></li>"});$("#section-tabs").html(t);$("#sidebar").fadeIn(200);$("#section-tabs a").click(function(e){e.preventDefault();if($(this).parent().hasClass("active"))return;$("html, body").animate({scrollTop:0},400);a($(this).attr("data-section"));return n()});return n()}})})};e=function(e,t,n){var r,i;if(n){r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);i="; expires="+r.toGMTString()}else i="";return document.cookie=e+"="+t+i+"; path=/"};o=function(e){var t,n,r,i;i=e+"=";n=document.cookie.split(";");r=0;while(r<n.length){t=n[r];while(t.charAt(0)===" ")t=t.substring(1,t.length);if(t.indexOf(i)===0)return t.substring(i.length,t.length);r++}return null};t=function(t){return e(t,"",-1)};$(document).ready(function(){var e;$("#spinner").spin({lines:9,length:2,width:10,radius:20});e=$(window);setTimeout(function(){return $("#sidebar").affix({offset:{top:40,bottom:0}})},100);s();return $("#lang-menu a").click(function(e){var n;e.preventDefault();n=$(this).attr("data-language");u(n);t("section");return s()})})}).call(this);